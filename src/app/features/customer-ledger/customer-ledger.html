<div class="ledger-main">
    <!-- Header -->
    <header class="header">
        <button class="btn btn-icon-only back-btn" (click)="goBack()">
            <span class="material-icons">arrow_back</span>
        </button>
        <div class="header-content" *ngIf="customer$ | async as customer" style="display: flex; align-items: center; width: 100%;">
            <div class="customer-details" style="flex: 1; display: flex; align-items: center;">
                <div class="avatar">{{ customer.name.charAt(0) | uppercase }}</div>
                <div class="info">
                    <h2>{{ customer.name }}</h2>
                    <p class="balance" [class.positive]="customer.currentBalance >= 0" [class.negative]="customer.currentBalance < 0">
                        {{ customer.currentBalance >= 0 ? translationService.t().ledger.you_will_get : translationService.t().ledger.you_will_give }}
                        ₹{{ customer.currentBalance | number }}
                    </p>
                </div>
            </div>
            
            <button mat-icon-button [matMenuTriggerFor]="customerMenu">
                 <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #customerMenu="matMenu">
                <button mat-menu-item (click)="editCustomer(customer)">{{ translationService.t().ledger.edit_customer }}</button>
                <button mat-menu-item (click)="deleteCustomer(customer)">{{ translationService.t().ledger.delete_customer }}</button>
            </mat-menu>
        </div>
    </header>

    <!-- Full Width Transactions List -->
    <div class="transactions-list">
        <ng-container *ngIf="transactions$ | async as transactions">
            <ng-container *ngFor="let t of transactions; let i = index">
                <!-- Year Separator -->
                <div class="year-separator" *ngIf="shouldShowYearHeader(i, transactions)">
                    <span class="year-label">{{ t.date | date:'yyyy' }}</span>
                </div>

                <div class="transaction-card-full" 
                     [class.gave]="t.type === 'GAVE'" 
                     [class.got]="t.type === 'GOT'"
                     (click)="openTransactionOptions(t)">
                     
                    <div class="card-left">
                        <div class="date-badge">
                            <span class="day">{{ t.date | date:'dd' }}</span>
                            <span class="month">{{ t.date | date:'MMM' }}</span>
                        </div>
                        <div class="details">
                            <span class="note" *ngIf="t.notes">{{ t.notes }}</span>
                            <span class="note empty" *ngIf="!t.notes">{{ translationService.t().ledger.no_details }}</span>
                            <span class="full-date">{{ t.date | date:'shortTime' }}</span>
                        </div>
                    </div>
                    
                    <div class="card-right">
                        <span class="amount" [class.gave-text]="t.type === 'GAVE'" [class.got-text]="t.type === 'GOT'">
                            ₹{{ t.amount | number }}
                        </span>
                        <span class="type-label">{{ t.type === 'GAVE' ? translationService.t().ledger.gave : translationService.t().ledger.got }}</span>
                    </div>
                </div>
            </ng-container>

            <div class="empty-state" *ngIf="transactions.length === 0">
                <p>{{ translationService.t().ledger.no_transactions }}</p>
            </div>
        </ng-container>
    </div>
    
    <!-- Header Context Menu for Customer -->
    <footer class="actions-footer">
        <button class="btn btn-lg btn-danger action-btn" (click)="addTransaction('GAVE')">
            <span class="material-icons">remove_circle_outline</span>
            {{ translationService.t().ledger.you_gave }} ₹
        </button>
        <button class="btn btn-lg btn-success action-btn" (click)="addTransaction('GOT')">
            <span class="material-icons">add_circle_outline</span>
            {{ translationService.t().ledger.you_got }} ₹
        </button>
    </footer>
</div>
